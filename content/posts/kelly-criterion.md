+++
date = '2025-12-20T00:00:00+08:00'
draft = false
title = '凯利公式：如何下注'
categories = ['决策框架']
weight = 1
+++

## 一个改变赌博和投资的公式

1956年，贝尔实验室的物理学家约翰·凯利发表了一篇论文，标题是《信息率的新解释》。

这篇论文本来是关于信息论的。但它包含了一个公式，后来改变了职业赌徒和专业投资者的思考方式。

这个公式回答了一个简单但深刻的问题：

**当你有优势时，应该下注多少？**

---

## 为什么这个问题重要

假设你发现了一个有利可图的机会：

- 60%的概率赢，赢了翻倍
- 40%的概率输，输了归零

你有100元。你应该下注多少？

直觉可能说：机会这么好，全押！

但如果你全押，只要输一次，你就出局了。即使你有60%的胜率，连续玩10次全押，归零的概率是99.99%。

那下注1元？太保守了。你有优势，应该利用它。

**问题是：有没有一个"最优"的下注比例？**

有。这就是凯利公式。

---

## 凯利公式

对于简单的赢/输赌注，凯利公式是：

$$f^* = \frac{bp - q}{b}$$

其中：
- $f^*$ = 最优下注比例（占总资金的百分比）
- $b$ = 赔率（赢了能赚多少倍）
- $p$ = 获胜概率
- $q$ = 失败概率（$= 1 - p$）

对于上面的例子（60%胜率，1:1赔率）：

$$f^* = \frac{1 \times 0.6 - 0.4}{1} = 0.2 = 20\%$$

你应该每次下注总资金的20%。

---

## 凯利公式的直觉

凯利公式在做什么？它在**最大化长期财富的几何增长率**。

回忆遍历性那篇文章：投资是乘性的，不是加性的。你的财富是一连串乘法的结果。

凯利公式找到的是：**让这一连串乘法的长期结果最大化的下注比例**。

它自动平衡了两个力量：
- **利用优势**：下注太少，优势没有被充分利用
- **避免毁灭**：下注太多，一次失败可能摧毁你

凯利比例是这两个力量的最优平衡点。

---

## 凯利公式的数学性质

### 1. 永远不会让你全押

不管优势多大，凯利公式永远不会建议100%下注（除非胜率是100%）。

为什么？因为全押有归零风险，而归零在乘性系统中是无法恢复的。

### 2. 没有优势时建议不下注

如果 bp ≤ q（期望值为负或零），凯利公式建议 f* ≤ 0。

不要下注。没有优势的游戏，最优策略是不玩。

### 3. 优势越大，下注越多

这是直觉的：胜率越高、赔率越好，应该下注越多。

凯利公式量化了这个关系。

### 4. 对概率估计敏感

如果你把60%的胜率错估为70%，你的下注比例会显著偏离最优。

这是凯利公式的实际限制：**它只有在你能准确估计概率时才有效**。

---

## 超过凯利的危险

下注比凯利比例少，结果是增长较慢，但风险也较低。这是保守策略。

下注比凯利比例多呢？

**超过凯利比例会导致长期财富的期望值下降。**

这是反直觉的。你可能以为"下注更多 = 赚更多"。但在乘性系统中，过度下注的波动会侵蚀长期收益。

更糟的是：超过凯利2倍，长期预期收益是零。
超过凯利更多，你的长期预期是亏损。

**过度激进比过度保守更危险。**

---

## 实际应用

### 1. 投资组合配置

凯利公式可以用于决定在某个投资机会上配置多少资金。

假设你认为某股票：
- 50%概率涨40%
- 50%概率跌20%

$$预期收益 = 0.5 \times 40\% + 0.5 \times (-20\%) = 10\%$$

$$凯利比例 = \frac{0.5 \times 2 - 0.5}{2} = 25\%$$

这意味着你应该把25%的资金配置在这个股票上。

### 2. 分散凯利

如果你有多个独立的投资机会，每个都可以用凯利公式计算。

但要注意：如果机会不是独立的（比如都受市场整体影响），你需要考虑相关性。

### 3. 部分凯利

很多实践者使用"半凯利"或"四分之一凯利"——即凯利建议比例的一半或四分之一。

为什么？
- 概率估计不确定
- 降低波动
- 心理舒适

部分凯利牺牲了一些期望收益，换取更平稳的路径和更大的[安全边际](/posts/margin-of-safety/)。这是对自己无知的诚实定价。

---

## 凯利公式的局限

### 1. 概率必须准确

凯利公式假设你知道真实概率。

现实中，你的概率估计往往是错的。高估胜率会导致过度下注。

**当不确定时，使用部分凯利。**

### 2. 独立性假设

基本凯利公式假设每次下注独立。

如果下注之间有相关性（比如都受同一因素影响），需要更复杂的分析。

### 3. 只优化最终财富

凯利公式只关心长期财富的几何增长率。

它不关心：
- 路径的波动
- 短期内的最大回撤
- 你的心理承受能力

凯利最优路径可能非常波动。很多人在到达长期最优之前就放弃了。

### 4. 不适用于负期望游戏

如果没有正期望，凯利公式无能为力。

它告诉你如何利用优势，但不能创造优势。

---

## 凯利公式与遍历性的联系

凯利公式是对[遍历性](/posts/ergodicity/)问题的数学回答。

传统金融学最大化"期望收益"——集合平均。
凯利公式最大化"几何平均收益"——时间平均。

两者的差别在遍历性那篇文章中已经解释过：在乘性系统中，时间平均才是你真正经历的。

**凯利公式是第一个严肃对待这个问题的数学框架。**

---

## 职业赌徒的智慧

凯利公式在职业赌徒和扑克玩家中广泛使用。

他们从经验中学到：
- 不管优势多大，永远不要全押
- 更愿意牺牲收益来降低破产风险
- 资金管理和找到优势一样重要
- 能够持续玩下去，比单次赢大更重要

这些直觉，凯利公式给出了数学基础。

---

## 给普通投资者的启示

### 1. 仓位比方向更重要

很多投资者只关心"买什么"，不关心"买多少"。

凯利公式说：**仓位决策和方向决策一样重要**。

即使方向对了，仓位错了也可能亏钱。

### 2. 谦逊地对待概率

你对任何投资的概率估计都可能是错的。

使用部分凯利。给不确定性留空间。

### 3. 永远不要全押

不管机会多好，永远保留东山再起的能力。

一个让你可能归零的仓位，不管期望值多高，长期都是错的。这与[尾部风险](/posts/tail-risk/)的教训一致——破产概率不是"小概率事件"可以忽略，它是决定长期命运的关键因素。

### 4. 关注生存，其次是增长

凯利公式的核心洞见是：**长期最大化增长的策略，同时也是确保生存的策略**。

这两个目标不是冲突的，而是同一个目标的两面。

---

## 一句话总结

**仓位决策和方向决策一样重要。**

凯利公式的核心洞见是：过度激进比过度保守更危险。全押即使在期望值为正的游戏中也会导致破产。

实践中，使用"半凯利"或"四分之一凯利"——因为你对概率的估计几乎肯定是错的，而凯利公式对估计误差极其敏感。
