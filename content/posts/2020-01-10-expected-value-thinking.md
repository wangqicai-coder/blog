+++
date = '2020-01-10T00:00:00+08:00'
draft = false
title = '期望值思维：在不确定性中寻找优势'
tags = ['Expected Value', '期望值', 'Kelly Criterion', '决策科学']
categories = ['思维模型', '决策科学']
series = '思维模型2020'
+++

## 引子：赌场为什么永远赢？

拉斯维加斯，凌晨3点。

一个赌徒在轮盘赌桌前，已经输了$5000。

他心想："我运气这么差，下一把肯定会赢！"（赌徒谬误）

他继续下注。

10分钟后，又输了$2000。

**为什么赌场永远赢？**

**不是因为每一局都赢，而是因为期望值（Expected Value）为正。**

### 轮盘赌的数学

**美式轮盘**：
- 38个格子（0, 00, 1-36）
- 赌红色（18个红色格子）
- 赔率：1:1（赌$100，赢了得$200，输了失$100）

**期望值计算**：

```
赢的概率 = 18/38 = 47.37%
输的概率 = 20/38 = 52.63%

EV = (18/38) × $100 + (20/38) × (-$100)
   = 47.37 - 52.63
   = -5.26

每赌$100，平均输$5.26
```

**赌场优势（House Edge）= 5.26%**

看起来不多？

**但**：
- 赌客每小时玩50局
- 每局平均$50
- 每小时EV = 50 × $50 × (-5.26%) = -$131.5

**10小时后，期望损失 = $1,315**

**赌场的秘密**：

**不是每局都赢，而是靠大数定律（Law of Large Numbers），长期必赢。**

今天，我们学习如何像赌场一样思考——**用期望值主导决策**。

## 核心概念：期望值的深度理解

### 数学定义

```
EV = Σ [P(结果ᵢ) × 价值(结果ᵢ)]

或：
EV = p₁×v₁ + p₂×v₂ + ... + pₙ×vₙ
```

**简单说**：每个可能结果的价值，按概率加权求和。

### 为什么期望值如此重要？

**大数定律（Law of Large Numbers）**：

当重复次数足够多时，**实际平均值会收敛到期望值**。

**例子：抛硬币**

```
单次：正面或反面（不确定）
10次：可能6正4反（偏差）
100次：约48正52反（接近50:50）
1000次：约497正503反（更接近）
10000次：约4998正5002反（几乎精确50:50）
```

**启示**：

**如果你能重复足够多次，期望值决定你的长期结果。**

### 三种期望值决策

| 类型 | EV | 决策 | 例子 |
|------|-----|------|------|
| **正期望值** | EV > 0 | 应该做（长期必赚） | 价值投资、创业（选对方向） |
| **零期望值** | EV = 0 | 无所谓（不赚不亏） | 公平赌博、某些对冲 |
| **负期望值** | EV < 0 | 不应该做（长期必亏） | 彩票、大多数赌博 |

## 期望值思维的实践应用

### 应用1：创业决策

**场景**：你被邀请作为CTO加入早期创业公司

**选项A**：留在大厂
- 100%概率：年薪$200,000
- 稳定工作
- 职业发展可预测

**选项B**：加入创业公司
- 年薪$120,000 + 1%股权
- 5年后退出场景：
  - 50%概率：公司失败，股权价值$0
  - 30%概率：小成功，$10M估值，股权价值$100,000
  - 15%概率：中等成功，$100M估值，股权价值$1M
  - 5%概率：大成功，$1B估值，股权价值$10M

**期望值计算（5年总收入）**：

**选项A**：
```
EV_A = $200,000 × 5 = $1,000,000
```

**选项B（只看财务）**：
```
工资收入 = $120,000 × 5 = $600,000

股权EV = 0.50 × $0
        + 0.30 × $100,000
        + 0.15 × $1,000,000
        + 0.05 × $10,000,000

       = 0 + $30,000 + $150,000 + $500,000
       = $680,000

总EV_B = $600,000 + $680,000 = $1,280,000
```

**纯财务期望值：选项B更优（$1.28M vs $1M）**

**但等等！这个分析缺少了什么？**

### 效用函数：金钱的边际价值递减

**$100万对不同人的价值不同**：

**场景1**：你有$10万存款
- 损失$10万 = 破产 = 效用 -∞
- 创业失败风险50% → 即使EV为正，也太危险

**场景2**：你有$200万存款
- 损失$10万 = 5%资产 = 可承受
- 创业值得尝试

**效用函数（Utility Function）**：

```
效用 ≠ 金钱数量
效用 = f(金钱，你的财务状况，风险偏好)
```

**常见形式**：对数效用函数

```
U(x) = ln(x)
```

**特点**：
- $0 → $100万：效用增加大
- $100万 → $200万：效用增加小
- **边际效用递减**

**重新计算（考虑效用）**：

假设你目前有$50,000存款：

```
选项A：确定获得$1M
  → 总资产 $1,050,000
  → 效用 U($1,050,000) = ln(1,050,000) = 13.86

选项B：概率分布
  失败(50%)：$600,000 → U = ln(650,000) = 13.38
  小成(30%)：$700,000 → U = ln(750,000) = 13.53
  中成(15%)：$1,600,000 → U = ln(1,650,000) = 14.32
  大成(5%)：$10,600,000 → U = ln(10,650,000) = 16.18

期望效用 = 0.5×13.38 + 0.3×13.53 + 0.15×14.32 + 0.05×16.18
         = 6.69 + 4.06 + 2.15 + 0.81
         = 13.71
```

**期望效用：选项A更优（13.86 vs 13.71）**

**关键洞察**：

**最大化期望金钱 ≠ 最大化期望效用**

### 应用2：投资组合

**场景**：你有$100,000，两个投资机会

**投资A**（低风险）：
- 年化收益率：8%
- 波动率：10%
- 概率分布（简化）：
  - 60%概率：赚10%
  - 40%概率：赚5%

**投资B**（高风险）：
- 年化收益率：20%
- 波动率：40%
- 概率分布：
  - 30%概率：赚50%
  - 40%概率：赚10%
  - 30%概率：亏20%

**期望收益**：

```
EV_A = 0.6 × 10% + 0.4 × 5% = 8%
EV_B = 0.3 × 50% + 0.4 × 10% + 0.3 × (-20%) = 13%
```

**看起来B更好？**

**考虑方差（风险）**：

```
Var_A = 0.6×(10%-8%)² + 0.4×(5%-8%)²
      = 0.6×4 + 0.4×9
      = 6
      → 标准差 ≈ 2.45%

Var_B = 0.3×(50%-13%)² + 0.4×(10%-13%)² + 0.3×(-20%-13%)²
      = 0.3×1369 + 0.4×9 + 0.3×1089
      = 410.7 + 3.6 + 326.7
      = 741
      → 标准差 ≈ 27.2%
```

**夏普比率（Sharpe Ratio）**：

```
夏普比率 = (期望收益 - 无风险利率) / 标准差

假设无风险利率 = 3%

Sharpe_A = (8% - 3%) / 2.45% = 2.04
Sharpe_B = (13% - 3%) / 27.2% = 0.37
```

**风险调整后收益：A更优！**

**最优组合（现代投资组合理论）**：

不是100% A或100% B，而是**组合**：

```
假设70% A + 30% B：
期望收益 = 0.7 × 8% + 0.3 × 13% = 9.5%
风险（简化）：介于A和B之间
```

**通过分散化，提高期望收益的同时降低风险。**

### 应用3：日常决策

**场景**：周五晚上，两个选项

**选项A**：去参加networking活动
- 80%概率：没什么收获，浪费3小时
- 15%概率：认识有趣的人，建立联系（价值：+5 效用）
- 5%概率：认识重要人物，改变职业轨迹（价值：+50 效用）
- 成本：-2 效用（时间、精力）

**选项B**：在家看Netflix
- 100%概率：放松愉快
- 价值：+3 效用

**期望效用**：

```
EV_A = 0.80 × (-2) + 0.15 × (5-2) + 0.05 × (50-2)
     = -1.6 + 0.45 + 2.4
     = 1.25

EV_B = 1.0 × 3 = 3
```

**看起来应该选B（在家）？**

**但考虑长期**：

如果你每周五都选B，1年52周：
```
总效用 = 52 × 3 = 156
```

如果每周五都选A，1年52周：
```
期望总效用 = 52 × 1.25 = 65

但有：
  - 约3次（5%×52）认识重要人物的机会
  - 实际效用可能远超期望值（非线性收益）
```

**关键**：

**某些决策的价值在于"创造可能性"，而非短期期望值。**

**Black Swan机会**（Nassim Taleb）：
- 概率极低
- 影响巨大
- 期望值计算可能低估真实价值

**策略**：

**对高upside、低downside的机会，即使期望值略低，也值得尝试（期权思维）。**

## Kelly Criterion：最优下注比例

### 问题的提出

**假设**：你发现一个正期望值的投资机会

- 60%概率赚1倍
- 40%概率亏掉全部投入

**期望值**：
```
EV = 0.6 × 1 + 0.4 × (-1) = 0.2 = +20%
```

**问题**：你应该投入多少比例的资金？

**选项**：
- 100%？（最大化期望值）
- 50%？
- 10%？

### Kelly Criterion公式

**John Kelly (1956)** 提出：

```
f* = (bp - q) / b

其中：
f* = 最优投资比例
b = 赔率（赢时获得倍数）
p = 胜率
q = 1 - p（败率）
```

**上面例子**：

```
b = 1（赢1倍）
p = 0.6
q = 0.4

f* = (1 × 0.6 - 0.4) / 1
   = 0.2
   = 20%
```

**最优策略：只投20%资金**

### 为什么不是100%？

**模拟对比**：

假设你有$1000，玩100次

**策略A：全仓（100%）**

```
第1次赢（60%）：$2000
第1次输（40%）：$0 → 破产，游戏结束
```

**即使期望值为正，40%概率你会破产！**

**策略B：Kelly比例（20%）**

```
资金 = $1000

第1次（假设赢）：
  投入 $200
  赢 $200
  新资金 = $1200

第2次（假设输）：
  投入 $240（20% × $1200）
  输 $240
  新资金 = $960

...

100次后（模拟）：
平均资金 ≈ $10,000+（增长约10倍）
破产概率 ≈ 0
```

**策略C：过度激进（50%）**

```
比Kelly高，增长更快，但风险急剧上升
破产概率 ≈ 15%
```

**策略D：过于保守（5%）**

```
几乎不会破产，但增长缓慢
100次后平均资金 ≈ $1500
```

### Kelly公式的数学原理

**最大化对数增长率（Logarithmic Growth Rate）**：

```
G(f) = p × ln(1 + fb) + q × ln(1 - f)

求导，令 dG/df = 0，得：

f* = (bp - q) / b
```

**对数增长的好处**：
1. **避免破产**（ln(0) = -∞，会极力避免）
2. **长期最优**（最大化复合增长）
3. **时间多样化**（Time Diversification）

### Kelly Criterion的实践调整

**Full Kelly vs Half Kelly**

很多专业投资者使用：

**Half Kelly = f*/2**

**原因**：
1. **参数估计误差**：如果你的p和b估计错误，Full Kelly可能过度激进
2. **降低波动**：Half Kelly大幅降低回撤
3. **心理可承受**：波动小，更容易坚持

**例子**：

```
Full Kelly = 20%
Half Kelly = 10%

Full Kelly：
  - 期望增长率：最优
  - 波动率：高
  - 最大回撤：-40%

Half Kelly：
  - 期望增长率：约75%的Full Kelly
  - 波动率：约50%的Full Kelly
  - 最大回撤：-20%
```

**Ed Thorp（对冲基金经理）的实践**：

> "我使用Half Kelly到Full Kelly之间。具体比例取决于我对估计参数的信心。"

### 巴菲特的隐形Kelly

**伯克希尔哈撒韦的投资组合（2023）**：

| 持仓 | 占比 |
|------|------|
| Apple | 约45% |
| Bank of America | 约10% |
| Coca-Cola | 约8% |
| American Express | 约7% |
| 其他 | 约30% |

**最大单一持仓：45%**

**为什么巴菲特重仓Apple？**

因为他认为：
- 胜率p极高（>90%）
- 赔率b合理（未来5-10年可能翻倍）
- Kelly公式允许大比例

**但他也不会100%**：
- 分散化（降低特定公司风险）
- 保持流动性
- 心理舒适度

## 期望值的陷阱与解药

### 陷阱1：样本太小，噪音主导

**错误**：玩5次，输了3次，就认为EV为负

**真相**：小样本不代表真实分布

**解决**：
- 增加样本量（至少30+次）
- 用统计显著性检验
- 不因短期波动改变策略

**Kahneman的研究**：

人们倾向于在**太短时间**内评估结果：
- 投资者每天查看账户 → 看到波动，焦虑，频繁交易
- 如果每年看一次 → 看到长期增长，心态稳定

### 陷阱2：忽略破产风险（Gambler's Ruin）

**即使EV为正，如果下注过大，依然会破产。**

**例子**：

```
游戏：60%赢1倍，40%输全部
期望值：+20%
策略：每次下注100%

第1次赢（60%）：$2000
第2次输（40%）：$0 → 破产

期望破产概率：
  1次后：40%
  2次后：64%（0.6×0.4 + 0.4）
  5次后：>90%
```

**即使长期期望值为正，你可能等不到"长期"。**

**解决**：Kelly Criterion

### 陷阱3：误估概率

**期望值公式的两个输入：**
1. 概率p
2. 价值v

**如果p估计错误，EV就错误。**

**例子**：创业者的乐观偏差

```
创业者认为：成功概率50%（实际5%）
  → 计算的EV很高
  → 做了错误决策

实际：
  P(成功) = 5%
  真实EV = 负值
```

**解决**：
1. **基础率**：先看行业平均成功率
2. **贝叶斯更新**：随证据调整概率
3. **外部视角**：假设你是旁观者，概率是多少？

### 陷阱4：效用函数非线性

**金钱的边际效用递减**

**例子**：

```
选项A：确定获得$1M
选项B：50%获得$3M，50%获得$0

EV_B = $1.5M > EV_A = $1M
```

**但多数人选A**（确定性效应）

**原因**：
- $0 → $1M：效用提升巨大（改变生活）
- $1M → $3M：效用提升有限（锦上添花）

**解决**：
- 最大化期望**效用**，而非期望**金钱**
- 用对数或幂函数建模效用

## 期望值思维的高级应用

### 应用：A/B测试的决策

**场景**：电商网站，两个版本

**版本A（当前）**：
- 转化率：2%
- 每日访客：10,000
- 每日转化：200单

**版本B（新设计）**：
- 测试样本：1000访客
- 转化：25单
- 转化率：2.5%

**问**：应该切换到版本B吗？

**一阶思维**："2.5% > 2%，切换！"

**期望值思维**：

**1. 计算置信区间**

```
版本B转化率的95%置信区间：
  p̂ = 0.025
  n = 1000

  SE = √[p̂(1-p̂)/n] = √[0.025×0.975/1000] ≈ 0.005

  95% CI = 0.025 ± 1.96×0.005
         = [0.015, 0.035]
         = [1.5%, 3.5%]
```

**2. 计算期望值**

**情景分析**：

| 真实转化率 | 概率 | 每日额外转化 | 价值（年） |
|----------|------|------------|----------|
| 3.5%（最好） | 5% | +150单 | $$ （巨大） |
| 2.5%（中等） | 60% | +50单 | $$ （中等） |
| 2.0%（相同） | 30% | 0 | $0 |
| 1.5%（更差） | 5% | -50单 | -$$ （损失） |

**假设每单利润$50**：

```
EV = 0.05 × (150×$50×365) + 0.60 × (50×$50×365)
     + 0.30 × 0 + 0.05 × (-50×$50×365)

   = 0.05 × $2.7M + 0.60 × $0.9M + 0 - 0.05 × $0.9M
   = $135K + $540K - $45K
   = $630K/年
```

**切换成本**：
- 开发时间：2周 = $20K
- 风险：如果失败，需回滚

**决策**：
```
EV = $630K - $20K - 风险成本
   ≈ $600K+

明确应该切换！
```

**3. 但要持续监测**

切换后：
- 每日监控转化率
- 如果低于预期（进入置信区间下限），准备回滚
- 贝叶斯更新：随新数据调整概率分布

### 应用：产品开发的投资组合

**场景**：你有10个产品idea，资源只够做3个

**如何选择？**

**期望值矩阵**：

| Idea | 成功概率 | 成功价值 | 失败成本 | EV |
|------|---------|---------|---------|-----|
| A | 80% | $1M | -$100K | $0.78M |
| B | 10% | $100M | -$500K | $9.55M |
| C | 50% | $5M | -$200K | $2.4M |
| D | 90% | $500K | -$50K | $0.4M |
| E | 5% | $1B | -$1M | $49M |
| ... | ... | ... | ... | ... |

**策略1：选EV最高的3个**

问题：如果都是低概率高价值（如B, E），可能全失败。

**策略2：Kelly式组合**

```
投资组合 =
  - 1个高概率中等回报（如A）：降低风险
  - 1个中等概率高回报（如C）：平衡
  - 1个低概率超高回报（如E）：保留upside
```

**分散化的期望值**：

```
EV_组合 = EV_A + EV_C + EV_E
        = $0.78M + $2.4M + $49M
        = $52.18M

但风险分散：
  - 至少1个成功的概率：约99%
  - 全失败概率：<1%
```

**Peter Thiel的观点**：

> "风投的回报遵循幂律分布。10个投资中，1个回报超过其他9个总和。所以要寻找10x-100x的机会，而非确定的2x。"

**但**：对个人/小公司，过度集中于低概率高回报风险太大。

**平衡**：根据你的资源和风险承受力调整。

## 深度反思：期望值的哲学

### 长期主义 vs 短期生存

**期望值思维假设**：你能重复足够多次。

**但现实**：
- 创业：可能只有1-2次机会（耗尽时间/资金）
- 职业：关键决策不多（如换行业）
- 人生：某些选择不可逆（如生孩子）

**解决**：
1. **优先保证生存**（避免破产）
2. **在生存基础上，优化期望值**
3. **创造多次尝试的条件**（如保持财务灵活性）

### 期望值 ≠ 人生意义

**Peter Thiel的例子**：

```
选项A：90%概率赚$10M
选项B：10%概率改变世界（赚$0）

纯期望值：选A
但Thiel选B（创立PayPal、投资Facebook）
```

**原因**：

**某些目标的价值不可用金钱衡量。**

**效用函数应包括**：
- 财富
- 影响力
- 个人成长
- 意义感
- 自由度

**最大化的是综合效用，而非单一维度。**

### 期望值思维的文化差异

**美国/硅谷**：
- "Swing for the fences"（全力以赴，争取本垒打）
- 接受高风险高回报
- 失败不羞耻（"fail fast, learn fast"）

**中国（传统）**：
- "稳中求进"
- 重视确定性收益
- 失败有社会成本（面子）

**哪个对？**

**都对，取决于环境**：
- 在机会多、容错高的环境：激进策略优
- 在机会少、容错低的环境：保守策略优

**关键**：**自知**——了解自己的风险承受力和价值观。

---

## 延伸阅读

1. **William Poundstone** - *Fortune's Formula*
   - Kelly Criterion的历史和应用

2. **Nassim Taleb** - *Fooled by Randomness*
   - 随机性与期望值的陷阱

3. **Ed Thorp** - *A Man for All Markets*
   - Kelly公式实战大师的回忆录

## 今日练习

### 练习1：计算日常决策的EV

列出3个你近期的决策：

| 决策 | 情景1 | P1 | 价值1 | 情景2 | P2 | 价值2 | EV |
|------|-------|-----|-------|-------|-----|-------|-----|
| 例：参加会议 | 收获大 | 20% | +10 | 收获小 | 80% | -2 | 0.4 |

计算EV，看是否改变你的选择。

### 练习2：Kelly公式应用

假设你有$10,000，发现一个投资机会：
- 70%概率赚30%
- 30%概率亏10%

1. 计算期望收益
2. 计算Kelly比例
3. 计算Half Kelly
4. 决定实际投入金额

### 练习3：模拟对比

用Python（或Excel）模拟：
- 全仓策略
- Kelly策略
- Half Kelly策略

运行100次，对比结果分布。

---

**明天预告**：我们将探讨**肥尾分布与黑天鹅**——当正态分布失效时，如何思考极端事件。

> *"从长期看，我们都死了。但在那之前，期望值决定了我们能走多远。"*
>
> **—— 改编自凯恩斯**

> *"不要告诉我你赢的概率，告诉我如果赢了能赚多少，如果输了会亏多少。"*
>
> **—— Nassim Taleb**
